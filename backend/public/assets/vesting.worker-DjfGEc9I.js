function C({maxTokenAmount:t,baseTokenClaimBps:e,unlockDurationDays:s,earlyVestRatioMinBps:a,earlyVestRatioMaxBps:i,dayT:o,totalLoyalty:l,totalLoyaltyIneligible:R,tokenAmount:n}){const E=t*e/1e4,c=t-E,I=o>=s,f=s>0?c*o/s:c,L=Math.min(f,c),d=E+L,y=Math.max(0,t-d),N=n-R,B=N>0?t*l/N:0;let M=0,p=0,V=0;if(!I&&y>0){const O=a/1e4,_=i/1e4;M=O+(_-O)*o/s,p=y*M,V=y-p}const b=I?t+B:d+p,g=t+B;return{base:E,bonus:c,vested:L,unlocked:d,locked:y,earlyVestRatio:M,earlyVestRatioPercent:M*100,earlyVestableBonus:p,totalIfEarlyClaim:b,forfeited:V,loyaltyBonus:B,totalIfWait:g,isUnlockComplete:I}}function P({maxTokenAmount:t,config:e,globalState:s,startDate:a}){if(!e||!t||t<=0)return[];const i=[],o=e.unlockDurationDays||90;for(let l=0;l<=o;l++){const R=C({maxTokenAmount:t,baseTokenClaimBps:e.baseTokenClaimBps,unlockDurationDays:o,earlyVestRatioMinBps:e.earlyVestRatioMinBps,earlyVestRatioMaxBps:e.earlyVestRatioMaxBps,dayT:l,totalLoyalty:s?.totalLoyalty||0,totalLoyaltyIneligible:s?.totalLoyaltyIneligible||0,tokenAmount:e.tokenAmount});let n="";if(a){const r=new Date(a);r.setDate(r.getDate()+l),n=r.toISOString().split("T")[0]}i.push({t:l,date:n,...R})}return i}self.addEventListener("message",t=>{const{type:e,payload:s}=t.data;if(e==="CALCULATE_TIMELINE")try{const a=P(s);self.postMessage({type:"TIMELINE_RESULT",payload:a})}catch(a){self.postMessage({type:"TIMELINE_ERROR",payload:{message:a.message}})}});
